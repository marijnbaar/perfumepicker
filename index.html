<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Perfume Recommendation App</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Animate.css -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <!-- React and ReactDOM -->
    <script
      src="https://unpkg.com/react@17/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"
      crossorigin
    ></script>
    <!-- Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      // Import Lucide icons from global variable.
      const { Heart, Sun, Moon } = window.lucide;

      // ThemeToggle Component
      const ThemeToggle = ({ isDark, onToggle }) => (
        <button
          onClick={onToggle}
          className="fixed top-4 right-4 p-2 rounded-full transition-colors duration-200"
        >
          {isDark ? (
            <Sun className="w-6 h-6 text-yellow-400" />
          ) : (
            <Moon className="w-6 h-6 text-gray-600" />
          )}
        </button>
      );

      // PerfumeCard Component
      const PerfumeCard = ({ perfume, onAction, actionType = "add", isDark }) => {
        // Parse notes: assume notes is an object with keys: top, middle, base.
        const parseNotes = (notesObj) => {
          if (!notesObj) return { top: [], middle: [], base: [] };
          if (typeof notesObj === "object" && (notesObj.top || notesObj.middle || notesObj.base)) {
            return notesObj;
          }
          // If notes is a string, split by commas.
          const notesArray = notesObj.toLowerCase().split(",").map(n => n.trim());
          return { top: notesArray, middle: [], base: [] };
        };

        const notes = parseNotes(perfume.notes);
        const cardBg = isDark ? "bg-gray-800" : "bg-white";
        const textColor = isDark ? "text-gray-100" : "text-gray-800";
        const borderColor = isDark ? "border-gray-700" : "border-gray-200";

        return (
          <div className={`${cardBg} rounded-xl shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 animate__animated animate__fadeIn border ${borderColor} p-4 mb-4`}>
            <div className="flex">
              <div className="w-32 h-40 flex-shrink-0">
                <img
                  src={perfume.thumbnail || perfume.imageUrl || "https://via.placeholder.com/128x160"}
                  alt={perfume.name}
                  className="w-full h-full object-cover"
                />
              </div>
              <div className="flex-1 pl-4">
                <h3 className={`text-xl font-medium mb-2 ${textColor}`}>{perfume.name}</h3>
                <p className={`${isDark ? "text-gray-300" : "text-gray-600"} mb-4`}>{perfume.description}</p>
                <p className={`text-sm ${isDark ? "text-gray-400" : "text-gray-500"} italic mb-2`}>
                  Designer: {perfume.brand || "Unknown"}
                </p>
                <div className={`${isDark ? "bg-gray-700" : "bg-purple-50"} rounded-lg p-4`}>
                  <p className={`text-sm font-semibold mb-2 ${isDark ? "text-gray-200" : "text-purple-700"}`}>
                    Notes:
                  </p>
                  <p className="text-sm mb-1"><strong>Top:</strong> {notes.top.join(", ")}</p>
                  <p className="text-sm mb-1"><strong>Middle:</strong> {notes.middle.join(", ")}</p>
                  <p className="text-sm"><strong>Base:</strong> {notes.base.join(", ")}</p>
                </div>
              </div>
              {onAction && (
                <button
                  onClick={() => onAction(perfume)}
                  className={`ml-4 p-2 rounded-full transition-all duration-300 ${isDark ? "hover:bg-gray-700" : "hover:bg-gray-100"}`}
                >
                  <Heart size={24} className="text-red-500" />
                </button>
              )}
            </div>
          </div>
        );
      };

      // Main App Component
      const App = () => {
        const [activeTab, setActiveTab] = React.useState("home");
        const [favorites, setFavorites] = React.useState([]);
        const [searchQuery, setSearchQuery] = React.useState("");
        const [perfumes, setPerfumes] = React.useState([]);
        const [isDark, setIsDark] = React.useState(false);

        // Update body background based on theme.
        React.useEffect(() => {
          document.body.className = isDark 
            ? "bg-gray-900 min-h-screen"
            : "bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 min-h-screen";
        }, [isDark]);

        // Load scraped data from scrapedData.json.
        React.useEffect(() => {
          fetch("scrapedData.json")
            .then(res => {
              if (!res.ok) {
                throw new Error("Network response was not ok " + res.status);
              }
              return res.json();
            })
            .then(data => {
              console.log("Loaded perfume data:", data);
              setPerfumes(data);
            })
            .catch(err => {
              console.error("Error loading perfume data:", err);
              setPerfumes([]);
            });
        }, []);

        // Filter perfumes by search query.
        const filteredPerfumes = React.useMemo(() => {
          return perfumes.filter(perfume => {
            const query = searchQuery.toLowerCase();
            return (
              perfume.name.toLowerCase().includes(query) ||
              (perfume.brand && perfume.brand.toLowerCase().includes(query))
            );
          });
        }, [perfumes, searchQuery]);

        // Toggle favorite
        const toggleFavorite = (perfume) => {
          setFavorites(prev => {
            const exists = prev.some(p => p.name === perfume.name && p.brand === perfume.brand);
            if (exists) {
              return prev.filter(p => p.name !== perfume.name || p.brand !== perfume.brand);
            } else {
              return [...prev, perfume];
            }
          });
        };

        return (
          <div className="max-w-6xl mx-auto p-6">
            <ThemeToggle isDark={isDark} onToggle={() => setIsDark(!isDark)} />

            <header className="text-center mb-12 animate__animated animate__fadeIn">
              <h1 className={`text-4xl font-light mb-4 ${isDark ? "text-gray-100" : "text-purple-800"}`}>
                Perfume Recommendation App
              </h1>
              <p className={isDark ? "text-gray-300" : "text-purple-600"}>
                Discover new fragrances and save your favorites
              </p>
            </header>

            <nav className="mb-8">
              <div className="flex justify-center gap-4">
                {["home", "favorites"].map(tab => (
                  <button
                    key={tab}
                    onClick={() => setActiveTab(tab)}
                    className={`px-6 py-3 rounded-full transition-all duration-300 ${
                      activeTab === tab 
                        ? "bg-purple-600 text-white" 
                        : isDark 
                          ? "bg-gray-800 text-gray-200 hover:bg-gray-700" 
                          : "bg-white text-purple-600 hover:bg-purple-50"
                    }`}
                  >
                    {tab.charAt(0).toUpperCase() + tab.slice(1)}
                  </button>
                ))}
              </div>
            </nav>

            {activeTab === "home" && (
              <div className="animate__animated animate__fadeIn">
                <div className="mb-6">
                  <input
                    type="text"
                    placeholder="Search by name or brand..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className={`w-full p-3 rounded-lg border focus:ring-2 focus:ring-purple-300 outline-none ${
                      isDark 
                        ? "bg-gray-700 text-gray-200 border-gray-600" 
                        : "bg-white text-gray-800 border-gray-300"
                    }`}
                  />
                </div>
                {filteredPerfumes.length === 0 ? (
                  <p className={isDark ? "text-gray-200" : "text-gray-800"}>No perfumes found.</p>
                ) : (
                  filteredPerfumes.map((perfume, index) => (
                    <PerfumeCard
                      key={index}
                      perfume={perfume}
                      onAction={toggleFavorite}
                      actionType={favorites.some(p => p.name === perfume.name) ? "remove" : "add"}
                      isDark={isDark}
                    />
                  ))
                )}
              </div>
            )}

            {activeTab === "favorites" && (
              <div className="animate__animated animate__fadeIn">
                {favorites.length === 0 ? (
                  <div className="text-center p-8 rounded-lg bg-white text-gray-600">
                    <p>Your favorites list is empty.</p>
                  </div>
                ) : (
                  favorites.map((perfume, index) => (
                    <PerfumeCard
                      key={index}
                      perfume={perfume}
                      onAction={toggleFavorite}
                      actionType="remove"
                      isDark={isDark}
                    />
                  ))
                )}
              </div>
            )}
          </div>
        );
      };

      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>